[platformio]
src_dir = .
include_dir = src
test_dir = test

[env:teensy41]
platform = teensy
board = teensy41
framework = arduino

; Build flags
; To disable laser safety interlock, add: -DDISABLE_LASER_INTERLOCK
; WARNING: Only use for systems without lasers. Removes safety protection.
build_flags =
    -D ARDUINO_TEENSY41
    -I src

; Exclude test directory from firmware build
build_src_filter =
    +<*>
    -<test/>

; Library dependencies
lib_deps =
    fastled/FastLED@^3.6.0
    bakercp/PacketSerial@^1.4.0

; Upload settings
upload_protocol = teensy-cli

; Monitor settings
monitor_speed = 2000000

; Native test environment (runs on host machine)
[env:native]
platform = native
build_flags =
    -I src
    -std=c++11
; Build filter for native tests:
; - Exclude everything by default (-<*>) since most firmware code has Arduino dependencies
; - Include only src/utils/*.cpp which contains pure C++ utilities (e.g., crc8.cpp)
; - Protocol constants are header-only (constants_protocol.h) so no build filter needed
; - If adding new host-testable modules, place them in src/utils/ or add explicit paths here
build_src_filter =
    -<*>
    +<src/utils/*.cpp>
